name: "üõ≥Ô∏è lighthouse"

on: pull_request

jobs:
    lighthouse:
        name: "üõ≥Ô∏è lighthouse"
        runs-on: ubuntu-latest
        steps:
            - name: "üìö checkout"
              uses: actions/checkout@v2.3.4
            - name: "üü¢ node"
              uses: actions/setup-node@v2.1.4
              with:
                  node-version: 14
                  registry-url: https://registry.npmjs.org/

            # option one
            - uses: UnlyEd/github-action-await-vercel@v1.2.14
              id: option-one
              env:
                  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
              with:
                  deployment-url: bradgarropy-next.vercel.app
                  timeout: 10
            - name: Display deployment status
              # run: echo The deployment at ${{ fromJSON(steps.option-one.outputs.deploymentDetails).url }} is ${{ fromJSON(steps.await-vercel.outputs.deploymentDetails).readyState }}
              run: echo The deployment at ${{ fromJSON(steps.option-one.outputs.deploymentDetails) }} is ${{ fromJSON(steps.await-vercel.outputs.deploymentDetails) }}

            # option two
            - run: sleep 30
            - name: vercel-preview-url
              uses: zentered/vercel-preview-url@v1.0.0
              id: option-two
              env:
                  VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
              with:
                  vercel_team_id: "bradgarropy"
                  vercel_project_id: "bradgarropy-next"
            - name: Get URL
              run: echo https://${{ steps.option-two.outputs.preview_url }}

            # option three
            - uses: aaimio/vercel-preview-url-action@v1
              id: option-three
              with:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
            - name: preview url
              run: echo The preview URL is ${{ steps.option-three.outputs.vercel_preview_url }}.

            - name: "üõ≥Ô∏è lighthouse"
              uses: treosh/lighthouse-ci-action@v8
              env:
                  LHCI_GITHUB_APP_TOKEN: ${{secrets.LHCI_GITHUB_APP_TOKEN}}
              with:
                  configPath: "./lighthouserc.js"
                  runs: 3
                  temporaryPublicStorage: true
                  uploadArtifacts: true
                  urls: ${{steps.netlify.outputs.url}}
